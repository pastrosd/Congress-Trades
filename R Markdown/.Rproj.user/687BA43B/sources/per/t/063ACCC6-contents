---
title: "Congress Trades"
author: "Daniel Pastros"
date: " `r lubridate::today()`"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
source('functions.R')

load_congress <- TRUE

min.yr <- 2020

```

```{r load}
if(TRUE == load_congress){
congress.df <- congress_json()

congressmod.df <- congress.df%>%filter(transaction_date>ymd(paste(min.yr,"0101",sep=""))&ticker != "--")

}

tickers.list <- congressmod.df%>%select(transaction_date,ticker)%>%unique()


```

## Introduction

Congress members are known for hearing important information that could indicate either the sentiment of the stock market or industry sectors status that could lead to a rally or crash.

This report was made to help track this sentiment, which starts out simple showing two major events the volume of buy/sells and which company are getting the most trading attention in either bullish (buy) or bearish (sell) behavior.

I am using two APIs one for the [House](https://housestockwatcher.com/) and one for the [Senate](https://senatestockwatcher.com/) that was set up by a company called Stock Watcher, which they scrap the governments website ([House](https://disclosures-clerk.house.gov/PublicDisclosure/FinancialDisclosure) and [Senate](https://www.senate.gov/pagelayout/legislative/g_three_sections_with_teasers/lobbyingdisc.htm)) for public filings of financial transactions from congress members. These website only show one or the other congress bodies and wanted to combine these data sets to get a bigger picture of the sentiment of trades that are occurring.

This report was made for entertainment purposes and I will continuously update it with improvements on current insight visual or look for new ways and packages that could be leveraged for data analytics on congress members' sentiment in the market and on certain stocks. Lets level the playing field!

## Data Review

```{r data review, echo=FALSE}
congress.df%>%
  filter(transaction_date>ymd("19000101"))%>%
  mutate(is_purchase = case_when(position == 'purchase'~1,TRUE~0),
         is_sale = case_when(position == 'sale'~1,TRUE~0))%>%
  summarize(`First Trade Date` = min(transaction_date),
            `Last Trade Date` = max(transaction_date),
            `Number of Records` = n(),
            `Number of Purchases` = sum(is_purchase),
            `Number of Sales` = sum(is_sale)
            )%>%pivot_longer(cols = c(`First Trade Date`,
                                      `Last Trade Date`,
                                      `Number of Records`,
                                      `Number of Purchases`,
                                      `Number of Sales`),
            values_transform = as.character)



```

## Trade Sentiment

Looking at the volume and type of trade that has occurred monthly could indicate the sentiment of the congress members making trades over the last 36 months.

```{r trading volume}

congress.trades <- congress.df%>%
  filter(transaction_date >= (today()- months(36))&position %in% c('sale','purchase'))%>%
  mutate(transaction_month = floor_date(transaction_date,'month'))%>%
  group_by(position,transaction_month)%>%
  summarize(trades = n())%>%
  group_by(transaction_month)%>%
  mutate(prct_trades = round(trades/sum(trades),digits=2))
  
congress.trades%>%
  filter(transaction_month<floor_date(Sys.Date(),'month'))%>%
  plot_ly(x=~transaction_month,y=~trades,
          color=~position,text =~prct_trades,type = 'bar')%>%
  layout(title = 'Sale & Purchase Trade Volume',
         yaxis = list(tickformat = ',.3r',title = 'Number of Trades'),
         xaxis = list(title = 'Trade Month'),
         barmode = 'stack'
         )

```

## Hottest Stock

In the last 12 months how many buys occurred on that stock.

```{r buying stock}

buy.stock <- congress.df%>%
  filter(transaction_date >= (today()- months(12))
         & ticker != "--"
         & position == 'purchase')%>%
  mutate(transaction_month = floor_date(transaction_date,'month'))%>%
  group_by(transaction_month,ticker)%>%
  summarize(trades = n())

buy.stock%>%
  plot_ly(x=~transaction_month,y=~trades,color=~ticker, mode = 'markers')%>%
  layout(title = 'Number of Buys by Ticker',
         yaxis = list(title = 'Number of Buys'),
         xaxis = list(title = 'Trade Month'),
         showlegend = F)

```

In the last 12 months how many buys occurred on that stock.

```{r selling stock}
sell.stock <- congress.df%>%
  filter(transaction_date >= (today()- months(12))
         & ticker != "--"
         & position == 'sale')%>%
  mutate(transaction_month = floor_date(transaction_date,'month'))%>%
  group_by(transaction_month,ticker)%>%
  summarize(trades = n())

sell.stock%>%
  plot_ly(x=~transaction_month,y=~trades,color=~ticker, mode = 'markers')%>%
  layout(title = 'Number of Sells by Ticker',
         yaxis = list(title = 'Number of Sells'),
         xaxis = list(title = 'Trade Month'),
         showlegend = F)
```
